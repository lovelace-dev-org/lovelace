{% extends 'courses/base.html' %}
{% load staticfiles %}
{% load i18n %}
{% load course_tags %}

{% block page-title %}{% trans 'Available courses' %}{% endblock %}

{% block breadcrumb-links %}
  <li><a href="{% url 'courses:index' %}">{% trans 'Courses' %}</a></li>
{% endblock %}

{% block toc %}{% endblock %}

{% block page-content %}
{% if course_list %}
  <h1>{% trans 'Available courses' %}</h1>
  <ul>
    {% for course in course_list %}
      <li>
        <div>
          <div>
            {#<a href="{% url 'courses:course_instances' course.slug %}">#}{{ course.name }}{#</a>#}
            {% if course.code %}â€“ {{ course.code }}{% endif %}
            {% if course.credits %}/ {{ course.credits }} {% trans 'credits' %}{% endif %}
          </div>
          {% if course.description %}<div>{{ course.description }}</div>{% endif %}
          <div>
            <ul>
              {% for instance in course.get_instances %}
                <li>
                  <div>
                    <a href="{% url 'courses:course' course.slug instance.slug %}">{{ instance.name }}</a>
                  </div>
                  <div>
                    {% with request.user|enrolled:instance as enroll_status %}
                      {% if enroll_status == None %}
                        <span class="instance-userinfo">You are not enrolled.</span><button onclick="show_popup(event, '{{ instance.slug }}-enrollment-application-popup')">{% trans 'Enroll' %}</button>
                      {% else %}
                        <span class="instance-userinfo">Enroll status: {{ enroll_status }}</span>
                      {% endif %}
                    {% endwith %}
                  </div>
                  <div class="popup" id="{{ instance.slug }}-enrollment-application-popup">
                    <div>
                      <h2>{% trans 'Enroll to' %} {{ instance.name }}</h2>
                      <form id="{{ instance.slug }}-enroll-form" class="enroll-form" method="POST" enctype="multipart/form-data" action="{%url 'courses:enroll' course.slug instance.slug %}">
                        {% csrf_token %}
                        
                        {% if instance.manual_accept %}
                          <div class="p">{% trans 'Enrollments to this course must be accepted by the teacher' %}</div>
                          <div class="p">{% trans 'You can attach a note to your enrollment application  by typing below' %}</div>                        
                          <textarea name="application-note" class="generic-textfield" placeholder="{% trans 'Type your application here' %}" rows="3"></textarea><br>
                        {% else %}
                          <div class="p">{% trans 'Enrollments to this course are accepted automatically' %}</div>
                        {% endif %}
                        
                        <input type="submit" name="submit" value="{% trans 'Send application' %}"></input>
                      </form>
                      <div class="enroll-status-msg" id="{{ instance.slug }}-enroll-status-msg"></>
                    </div>
                  </div>                  
                  {% comment %}
                  <div>
                    <span class="instance-userinfo">Your progress: </span>
                    <progress max="5" value="3" title="3/5 completed"></progress>
                  </div>
                  {% endcomment %}
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>{% trans 'No courses available!' %}</p>
{% endif %}
{% endblock %}
